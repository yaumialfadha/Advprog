# Tutorial 6: Refactoring & Testing

CSCM602023 Advanced Programming @ Faculty of Computer Science Universitas
Indonesia, Term 2 2017/2018

* * *

Your main task in this tutorial is to refactor an existing code that generates
report of rent charges owed by a customer in a movie rental shop. The initial
starter code has tests that verify correctness of the code but contains code
duplication, thus need to be refactored as well.

The problem set used in this tutorial is based on example written in Refactoring
**chapter 1 & 2**. Please read the book, specifically sections that discuss the
running code example, to know which refactoring techniques to apply in
completing the tutorial.

The evaluation of your work will be based on number of passing unit tests,
code style issues, and your understanding on each refactoring techniques
applied in the tutorial. Code style issues can be checked from test report
generated by Gradle. Your understanding will be verified by teaching team
during in-person demo session and/or merge request review.

**Caution: Unless noted otherwise, you are not allowed to modify the _existing_
unit tests without permission from the teaching team!**

## Mandatory Tasks Description

There are three Java classes in the `/src/main/java/` directory: `Movie`,
`Rental`, and `Customer`. Each classes represent movie, movie being
rented by a customer, and customer who rent the movie in the store. The
focus of this tutorial is the `statement()` method in `Customer` class.
The method must be refactored by applying several refactoring techniques
described in the instructions below.

After `statement()` has been refactored, notice that the test code in
`/src/test/java/` directory contains code duplication, especially when
setting up test fixtures. The redundancy can be reduced by refactoring
the test code to use instance variable for storing the fixture and use
JUnit 4's `@SetUp` annotation to label a method as a test setup method
that will be executed before each test methods.

Your tasks in this tutorial is as follows:

1. Refactor the switch-case statement in `statement()` method using
**Extract Method** refactoring
2. Move the extracted method from step (1) to `Rental` class using
**Move Method** refactoring
3. Refactor the calculation of frequent renter points into separate
method using **Extract Method** and move the method to `Rental` by applying
**Move Method** refactoring
4. Replace usage of `frequentRenterPoints` temporary variable to use query
method by applying **Replace Temp with Query** refactoring
5. Replace usage of `totalAmount` temporary variable to use query method
by applying **Replace Temp with Query** refactoring
6. Reduce code redundancy (duplication) in test classes, i.e. `MovieTest`,
`RentalTest`, and `CustomerTest`

## Additional Tasks Description

Similar to the previous tutorial, you need to ensure that your code does not
contain any style/linter issues. You can run the linter (Checkstyle) by
executing `checkstyleMain` Gradle task. However, since you have begin writing
your own test, please ensure that the test code does not contain style issues
as well. You can check for lint issues in test code by executing
`checkstyleTest` Gradle task.

> Tips: You can also find Checkstyle plugin for your IDE of choice and let
> the plugin handle the checking. Do not forget to configure the plugin to
> use `google_csui_checks.xml` Checkstyle configuration in the `config`
> directory.

There are three additional tasks in this tutorial. The tasks are described in
following subsections.

### Create Variation of `statement()`: `htmlStatement()`

Refactoring chapter 1 mentioned that there is a possible change of requirement
where the software should be able to produce the statement in HTML format.
Please implement `htmlStatement()` method in `Customer` class that will produce
the same statement in HTML format. PLease reuse the new methods produced during
refactoring in mandatory tasks.

### Reflect on Refactoring Result

It is possible to implement `statement()` and `htmlStatement()` without having
to refactor the code. However, there are some drawbacks had we developed them
without conducting refactoring. Please reflect on what you have done during
completing the mandatory tasks and write the report in the designated section
in this document.

### Write More Comprehensive Test

After you create `htmlStatement()`, you also need to create the test for ensuring
correctness of its implementation. Feel free to add more tests to increase the code
coverage to 100%.

## Running & Testing the Program

It is recommended to use IDE that can import Gradle-based project to complete this
tutorial. If you are using IDE, **please import `build.gradle` located in the
parent directory (root) of this tutorial.** The tutorials are structured as
Gradle multi-projects and the content of `build.gradle` in each tutorial
directories is defined in the main (root) `build.gradle` file.

You can run the unit tests by executing `test` Gradle task from your IDE. If you
prefer terminal/shell:

```bash
gradle :tutorial-6:test
```

> Explanation: Run `test` task available in `tutorial-6` Gradle (sub)project

If you want to run code linter (Checkstyle) to check find code style issues in
your work, execute `checkstyleMain` or `checkstyleTest` Gradle task from your IDE
or via terminal/shell:

```bash
gradle :tutorial-6:checkstyleMain
gradle :tutorial-6:checkstyleTest
```

> Explanation: Run `checkstyleMain` and `checkstyleTest` tasks available in
> `tutorial-6` Gradle (sub)project

> Tips: You can run both linter and unit tests sequentially by executing `check`
> Gradle task. If you prefer terminal/shell: `gradle :tutorial-6:check`

## Mandatory Tasks Checklist

- [ ] Refactor `statement()` method in `Customer` class
- [ ] Make at least 3 commits that contains your progress in refactoring
`statement()` method in `Customer` class
- [ ] Refactor test classes
- [ ] Make at least 1 commit that contains your progress in refactoring
test classes
- [ ] Ensure the tests still pass after each refactoring
- [ ] Push your commits to online Git repository on your GitLab project

## Additional Tasks Checklist

- [ ] Make sure there are no code style issues, both in production code and
test code
- [ ] Implement `htmlStatement()` method in `Customer` class
- [ ] Create tests for testing `htmlStatement()` method using JUnit 4
- [ ] Ensure 100% code coverage
- [ ] Reflect on the refactoring activities that you have done and answer the
following questions:
    - What are the benefits of refactoring based on your observation?
    - What are the bad qualities observed in the code if we did not refactor
    the code?
    - Suppose that you did not conduct refactoring and did implement the
    `htmlStatement` by copy-pasting the algorithm from the original `statement`,
    what do you think the final result look like?
    - Write your answer in [My Notes](#my-notes) section in this document

## My Notes

> Feel free to use this section to write your own notes related to your attempt
> in doing the tutorial. You can also use this section to write text for
> answering question(s) mentioned in the task checklists.
